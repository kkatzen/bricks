<link rel="stylesheet" href="lib/codemirror.css">
<link rel="stylesheet" href="theme/mbo.css">
<link rel="stylesheet" href="addon/display/fullscreen.css">
<script>
		<%
		User.find({admin: true}).exec(function(err, users) {
				if(err) {
						console.log("error: " + err);
				} else {
						if(users.length == 0) {
								res.redirect("/user/setup");
						}
				}
		});
		%>
		function deleteFolder(id){
		allFolders[id].remove();
		};
		function deleteProblem(id){
				var classname = "#li-" + id;
				$(classname).remove();
		};
		function addProblem(problem){
		var item = $("<li></li>").attr("id","li-" + problem.id).html(problem.name);
		var close = $("<a></a>").attr("class","delete").css("margin-left","5px").click(function() {
						$.post("/problem/delete", {id: problem.id}, function(problem){
						});
						deleteProblem(problem.id);
		});
				//add problem under containing folder
				//$("#l-" + problem.folder).append("<li id='li-" + problem.id + "'>" + problem.name + "</li>");
				$("#l-" + problem.folder).append(item).append(close);
				//add delete button/method to problem
		/*
		$("#li-" + problem.id).append("<a class='delete' style='margin-left: 5px;'><span class='glyphicon glyphicon-remove'></span></a>").click(function(){
						$.post("/problem/delete", {id: problem.id}, function(problem){
								alert("successfully deleted");
						});
						deleteProblem(problem.id);
				});
		*/
		};
</script>
<link rel="stylesheet" href="http://code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
<script src="http://code.jquery.com/jquery-1.10.2.js"></script>
<script src="http://code.jquery.com/ui/1.11.4/jquery-ui.js"></script>

<script src="/js/admin.js"></script>
<style>

	#sortable { list-style-type: none; margin-top: 4px; padding: 0; width: 100%;}
	#sortable ul { list-style-type: none; margin-top: 4px; padding: 0; width: 100%;}
	#sortable ul > li { background: none; border: 0px solid white; margin-left: 5px;}

	.sortableGrip2 { cursor: move; float: left; };
	.sortableFolder {margin-top: 5px; padding-left: 0px; padding-right: 0px;}
	.sortableGrip { cursor: move; float: left; };


#navigationPanel {
	margin-top: 20px;
	padding: 0px;
}
form > button {
	margin-top: 10px;
}
.navbar-default {
		margin-top: 20px;
}
#folderBar {
	padding: 0px;
}
#folderBar > div {
	margin-right: 10px;
}
.alert {
		margin-top: 10px;
		margin-bottom: 0;
}
#pointbreakdown {
	border: 2px solid gray;
	float:right; 
	width:233px; 
	margin-left:5px;
	padding:5px;
}

</style>
<script src="lib/codemirror.js"></script>
<script src="../mode/javascript/javascript.js"></script>
<script src="../addon/selection/active-line.js"></script>
<script src="../addon/display/fullscreen.js"></script>

<nav style="margin-bottom: 0" class="navbar navbar-inverse" role="navigation">
	<div class="container-fluid">
		<!-- Brand and toggle get grouped for better mobile display -->
		<div class="navbar-header">
			<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<a class="navbar-brand" href="../">Bricks</a>
			<a class="navbar-brand" href="#students" data-toggle="pill">Students</a>
			<a class="navbar-brand" href="#admin" data-toggle="pill">Manage</a>
			<a class="navbar-brand" href="#progress" data-toggle="pill"> Progress</a>
		</div>
		<div class="navbar-right">
			<p class="navbar-text"><%= req.user.displayName %></p>
			<form class="navbar-form navbar-right">
				<a href="/login/logout" id="logout" class="btn btn-default">Logout</a>
			</form>
		</div>
	</div><!-- /.container-fluid -->
</nav>


<div class="container-fluid ">
<% if (req.isAuthenticated() && req.user.admin) {%>

	<!-- SIDE BAR -->
	<div id="navigationPanel" class="panel panel-default col-md-2  ">
		<button id="sortFolders" type="button" class="btn btn-default">Edit Folders</button>
		<button id="sortFolders" type="button" class="btn btn-default" href="#addquestion" data-toggle="pill">Add</button>
		<p>
		<div class="panel-group" id="leftSideFolders"></div>
	</div>
	<!-- END SIDE BAR -->


	<!-- BODY -->
	<div class="tab-content  col-md-10 ">

		<!-- QUESTION SECTION -->
		<div class="tab-pane active" id="questions">

			<!-- DISPLAY QUESTION SECTION -->
			<div class="panel panel-default">

				<!-- DISPLAY QUESTION HEADING -->
				<div class="panel-heading">
					 <h4 class="panel-title" >
							<a data-toggle="collapse" data-parent="#accordion" href="#displayQuestionCollapse" aria-expanded="true" id="problemDisplayName"> Choose a Problem</a>
					</h4>
				</div>

				<!-- DISPLAY QUESTION BODY -->
				<div class="collapse" id="displayQuestionCollapse">
					<div class="panel-body">
						<div id="pointbreakdown" class="hidden" >
							Point Breakdown:<br/>
							Style- <span id="availablePtStyle"></span>
							<br />
							Func- <span id="availablePtCorrect"></span>
							<br />
						</div>
						<div id="problemDisplayBody" >
							Select a problem from the left to view more information.
						</div>
					</div>
				</div>
			</div>
			<!-- DISPLAY QUESTION SECTION END -->

			<!-- EDIT QUESTION SECTION -->
			<div class="panel panel-default">

				<!-- EDIT QUESTION HEADING -->
				<div class="panel-heading">
					<h4 class="panel-title">
						<a data-toggle="collapse" data-parent="#accordion" href="#editQuestionCollapse" aria-expanded="true" >Edit</a>
					</h4>
				</div>

				<!-- EDIT QUESTION BODY -->
				<div class="panel-collapse collapse" id="editQuestionCollapse">
					<div class="panel-body">
						<p id="editPlaceholder">Select a problem from the left to edit it</p>
						<form id="edit" class="form hidden">
							<div class="row">
								<div class="form-group">
									<div class="col-md-3">
										<label class="control-label" for="editType">Type</label>
										<select id="editType" name="editType" class="form-control">
											<option value="twit">twit</option>
											<option value="diy">diy</option>
											<option value="wall">wall</option>
											<option value="exam">exam</option>
										</select>
									</div>
									<div class="col-md-3">
										<label class="control-label" for="editPhase">Phase</label>
										<select id="editPhase" name="editPhase" class="form-control">
											<option value="0">Past</option>
											<option value="1">Present</option>
											<option value="2">Future</option>
										</select>
									</div>
									<div class="col-md-3">
										<label class="control-label">Function Points</label>
										<input id="editCorrectPoints" class="form-control">
									</div>
									<div class="col-md-3">
										<label class="control-label">Style Points</label>
										<input id="editStylePoints" class="form-control">
									</div>
									<div class="col-md-3">
										<label class="control-label" for="editProblemLanguage">Language</label>
										<select name="editLanguage" id="editLanguageDropdown" class="form-control">
											<option value="javascript">JavaScript</option>
											<option value="java">Java</option>
										</select>
									</div>
								</div>
							</div>
							<div class="row">
								<div class="form-group">
									<div class="col-md-6">
										<label class="control-label" for="editProblemName">Name</label>
										<input id="editProblemName" name="editName" type="text" class="form-control"></input>
									</div>
									<div class="col-md-6">
										<label name="editFolder" class="control-label" for="folder">Folder</label>
										<select id="editFolderDropdown" class="form-control">  </select>
									</div>
								</div>
							</div>
							<label class="control-label" for="editDescription">Description</label>
							<textarea name="editDescription" id="editDescription" class="form-control"></textarea>
							<label class="control-label" for="editOnSubmit">Function to run on submission</label>
							<textarea name="editOnSubmit" id="editOnSubmit" class="form-control" 
									 style="font-family:Consolas, monospace">
							</textarea>
							<button class="btn btn-default form-control" id="editProblem">Update Problem</button>
							<div id="editProblemError"></div>
						</form>
					</div>
				</div>
			</div>
			<!-- EDIT QUESTION SECTION END -->

			<!-- PROGRESS BAR SECTION -->
			<div class="progress">
				<div class="progress-bar progress-bar-success" style="width: 0%" id="pbp-green" data-toggle="tooltip" data-placement="top" title="Students who earned full points">
					<span class="sr-only">35% Complete (success)</span>
				</div>
				<div class="progress-bar progress-bar-warning progress-bar-striped" style="width: 0%" id="pbp-yellow" data-toggle="tooltip" data-placement="top" title="Students who submitted but did not earn full points">
					<span class="sr-only">20% Complete (warning)</span>
				</div>
				<div class="progress-bar progress-bar-danger" style="width: 0%" id="pbp-red">
					<span class="sr-only">10% Complete (danger)</span>
				</div>
			</div>
			<!-- PROGRESS BAR SECTION END -->

			<!-- STUDENT PROGRESS SECTION -->
			<div class="panel panel-default">
				<div class="panel-heading">
					Student Progress  <span id="function" class="label label-info" data-toggle="tooltip" data-placement="top" title="Students with full correct points">0%</span><span id="style" class="label label-success" data-toggle="tooltip" data-placement="top" title="Students will full style points">0%</span>
					<button class="btn btn-primary btn-sm pull-right" id="refreshData">Refresh</button>
				</div>
				<div id="allStudents1ProblemTable">
					<div class="panel-body">
						Select a problem to view student progress
					</div>
				</div>
			</div>
			<!-- STUDENT PROGRESS SECTION ENDS -->

		</div>
		<!-- QUESTION SECTION ENDS -->


		<!-- ADD QUESTION SECTION -->
		<div  class="panel panel-default tab-pane" id="addquestion">
			<div class="panel-heading">
				Add a new question
			</div>
			<div class="panel-body">
				<form id="addProblemForm" class="form">
					<div class="row">
						<div class="form-group">
							<div class="col-md-3">
								<label class="control-label" for="type">Type</label>
								<select  id="type" class="form-control">
									<option value="twit">twit</option>
									<option value="diy">diy</option>
									<option value="wall">wall</option>
									<option value="exam">exam</option>
								</select>
							</div>
							<div class="col-md-3">
								<label class="control-label" for="phase">Phase</label>
								<select  id="phase" class="form-control">
									<option value="2">Future</option>
									<option value="1">Present</option>
									<option value="0">Past</option>
								</select>
							</div>
							<div class="col-md-3">
								<label class="control-label">Function Points</label>
								<input id="correctPoints" value=2 class="form-control">
							</div>
							<div class="col-md-3">
								<label class="control-label">Style Points</label>
								<input id="stylePoints" value=2 class="form-control">
							</div>
							<div class="col-md-3">
								<label class="control-label" for="language">Language</label>
								<select id="languageDropdown" class="form-control">
									<option value="javascript">JavaScript</option>
									<option value="java">Java</option>
								</select>
							</div>
						</div>
					</div>
					<div class="row">
						<div class="form-group">
							<div class="col-md-6">
								<label class="control-label" for="name">Name</label>
								<input  id="problemName" type="text" class="form-control">
							</div>
							<div class="col-md-6">
								<label class="control-label" for="folder">Folder</label>
								<select id="folderDropdown" class="form-control"> </select>
							</div>
						</div>
					</div>
					<div class="row">
						<div class="form-group">
							<div class="col-md-12">
								<label class="control-label" for="description">Description</label>
								<textarea id="description" class="form-control"></textarea>
							</div>
						</div>
					</div>
					<div class="row">
						<div class="form-group">
							<div class="col-md-12">
								<label class="control-label" for="onSubmit">Function to run on submission</label>
								<textarea id="onSubmit" class="form-control" 
									 style="font-family:Consolas, monospace">
								</textarea>
							</div>
						</div>
					</div>
					<button class="btn btn-default form-control" id="addProblem">Add Problem</button>
					<div id="newProblemError"></div>
				</form>
			</div>
		</div>
		<!-- ADD QUESTION SECTION ENDS -->
		
		<!-- SUBMISSION SECTION -->
		<div class="tab-pane" id="submission">
			<div class="panel panel-default">
				<div class="panel-heading">
					<h4 class="panel-title">
						<a data-toggle="collapse" data-parent="#accordion" href="#submissionCollapse" id="submissionTitle">
							Collapsible
						</a>
					</h4>
				</div>
				<div id="submissionCollapse" class="panel-collapse collapse in">
					<div class="panel-body">
						Created By: <span id="submissionCreatedBy"></span><br />
						Created At: <span id="submissionCreatedAt"></span><br />
						Points: <span id="submissionPoints"></span>
					</div>
				</div>
			</div>		
			<div class="alert alert-warning" id="submissionMessage"></div>
			<textarea id="codemirror"></textarea>

			<div class="panel panel-default">
				<div class="panel-heading">
					<h4 class="panel-title">
						<a data-toggle="collapse" data-parent="#accordion" href="#relatedSubmissionCollapse" id="submissionTitle">
							Related Submissions
						</a>
					</h4>
				</div>
				<div id="relatedSubmissionCollapse" class="panel-collapse collapse in">
					<div class="panel-body">
					<ul id="relatedSubmissions">
					</ul>
					</div>
				</div>
			</div>			

		</div>
		<!-- SUBMISSION SECTION ENDS -->

		<!-- PROGRESS SECTION -->
		<div class="tab-pane" id="progress">
			<h1>Progress</h1>
		</div>
		<!-- PROGRESS SECTION ENDS -->

		<!-- ADMIN SECTION -->
		<div class="tab-pane" id="admin">
			<p>View admins and give administrative privileges here</p>
			 <div class="panel panel-default">
				<div class="panel-heading">Manage admins</div>
 
				 <ul id="admins" class="list-group"></ul>

				 <div class="panel-body">
					 <div class="input-group">
						<input type="text" id="newAdmin" class="form-control" placeholder="Type username..."></input>
						<span class="input-group-btn">
							 <button type="submit" id="newAdminBtn" class="btn btn-default"><span class="glyphicon glyphicon-plus" style="color:green;"></span></button>
						</span>
					 </div>
					 <div id="newAdminError"></div>
				 </div>
			 </div>
		</div>
		<!-- ADMIN SECTION ENDS -->

		<!-- LIST STUDENTS SECTION -->
		<div class="tab-pane" id="students">
			<div class="panel panel-default">
				<div class="panel-heading"><h4 class="panel-title">Students</h4></div>

				<form class="form-inline">
					<div class="form-group">
						<input type="text" class="form-control" id="onyen" placeholder="Enter onyen">
						<!--<button href="#individualStudent" type="button" class="btn btn-primary"  data-toggle='pill' id="onyenSearchButton">Submit</button>-->
						<a href="#individualStudent" data-toggle="pill" class="btn btn-info" role="button" id="onyenSearchButton">Link Button</a>
					</div>
				</form>
				<div id="viewStudentsList">
					<div class="panel-body">
						Loading students...
					</div>
				</div>
			</div>
		</div>
		<!-- LIST STUDENTS SECTION ENDS -->

		<!-- INDIVIDUAL STUDENT SECTION -->
		<div class="tab-pane" id="individualStudent">
			<h1 id="individualName"></h1>

			<!-- PROGRESS BAR-->
			<div id="individualProgessBar" class="hidden col-md-12"></div>

			<!--SUBMISSION LIST-->
			<div id="individualSubmissionList"></div>

		</div>
		<!-- INDIVIDUAL STUDENT SECTION ENDS -->

	</div>
	<!-- BODY ENDS -->

<!--Admin section ends-->
<%} else if (!req.isAuthenticated()) {%>
	 <% res.redirect("/login?d=admin"); %>
<%} else {%>
	<nav class="navbar navbar-default">
			<div class="container-fluid">
					<div class="navbar-header">
							<a class="navbar-brand" href="#">Admin Page</a>
					</div>
					<form class="navbar-form navbar-right">
							<a href="/login/logout" id="logout" class="btn btn-default">Logout</a>
					</form>
			</div>
 </nav>
 <p>You must be an admin to view this page</p>
<%}%>
</div>

